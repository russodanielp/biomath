
%%     Parameter Values:
    Time_Sim_production_rate_k = 1;
     MAb_Ka = 0.025;
     MAb_F = 0.6;
     MAb_PCSK9_kel = 0.0025;
     MAb_PCSK9_Kd = 0.6;
     volume_pl = 2.75;
     MAb_MW = 1.46e+05;
     convert_nmol_to_mmol = 1e-06;
     MAb_dose_duration = 1;
     MAb_dose_start = 0;
     MAb_dose_interval = 672;
     Statin_MW = 1209.4;
     Statin_dose_duration = 1;
     Statin_dose_start = 0;
     Statin_dose_interval = 24;
     Statin_Ka = 1;
     Statin_F = 0.14;
     MAb_kel = 0.00125;
     Statin_kel = 0.1;
     LDL_LDLR_en_Kd = 4000;
     chol_per_VLDL_particle = 1750;
     SREBP_Chol_nh = 4;
     SREBP_Chol_EC50 = 0.55;
     Statin_Chol_Imax = 1;
     Statin_Chol_nh = 0.5;
     Chol_SREBP_nh = 5;
     LDL_LDLR_pl_Kd = 2000;
     SREBP_LDLR_nh = 3;
     SREBP_LDLR_EC50 = 0.55;
     PCSK9_pl_clearance_rate_k = 0.1;
     PCSK9_LDLR_en_Kd = 10;
     PCSK9_LDLR_pl_Kd = 350;
     chol_per_LDL_particle = 1750;
     chol_per_HDL_particle = 75;
     ApoA1_pl_clearance_rate_k = 0.00238;
     ApoB_pl_clearance_rate_k = 0;
     ApoA1_RCT_nh = 1;
     ApoA1_RCT_EC50 = 1.5e+05;
     VLDL_to_LDL_conversion_rate_k = 0.0711;
     HDL_to_LDL_exchange_rate_k = 0.0017;
     Chol_ic_P_to_HDL_pl_rate_k = 0.000577;
     volume_P = 2.75;
     LDL_LDLR_P_internalization_rate_k = 7.55;
     LDLR_P_internalization_rate_k = 8.3;
     LDLR_P_recycling_rate_k = 8.3;
     PC9_LDLR_P_internalization_rate_k = 8.3;
     volume_en_P = 0.02;
     LDLR_en_P_degradation_rate_k = 0.0219;
     PC9_LDLR_en_P_degradation_rate_k = 0.1;
     PCSK9_en_P_degradation_rate_k = 0.11;
     LDL_en_to_Chol_ic_P_rate_k = 7.55;
     Chol_ic_P_elimination_rate_k = 0;
     Chol_ic_P_production_rate_k = 72500;
     SREBP_ic_P_production_rate_k = 7.62;
     SREBP_ic_to_nu_P_activation_rate_k = 0.0693;
     SREBP_nu_P_degradation_rate_k = 0.693;
     SREBP_ic_P_degradation_rate_k = 0.693;
     LDLR_ic_P_production_rate_k = 0.6;
     LDLR_ic_to_cs_P_trafficking_rate_k = 0.2;
     VLDL_pl_P_uptake_rate_k = 0;
     VLDL_pl_P_LDLRuptake_rate_k = 0;
     HDL_to_VLDL_exchange_rate_k = 0.0238;
     LDL_pl_LDLRind_P_uptake_rate_k = 0.00034;
     calculation_switch = 0;
     convert_frac_to_pct = 100;
     convert_ng_to_mg = 1e-06;
     ApoB_MW = 5.15e+05;
     ApoA1_MW = 28000;
     convert_nM_to_uM = 0.001;
     ApoB_HDL_VLDL_nh = 1;
     ApoB_HDL_VLDL_EC50 = 1000;
     CETP_HDL_VLDL_nh = 1;
     CETP_HDL_VLDL_EC50 = 100;
     ApoB_HDL_LDL_nh = 1;
     ApoB_HDL_LDL_EC50 = 1000;
     CETP_HDL_LDL_nh = 1;
     CETP_HDL_LDL_EC50 = 100;
     Chol_SREBP_Imax = 1;
     weight_ApoB_HDL_VLDL = 1;
     weight_CETP_HDL_VLDL = 1;
     weight_ApoB_HDL_LDL = 1;
     weight_CETP_HDL_LDL = 1;
     MAb_PCSK9_association_rate_k = 0.36;
     LDL_LDLR_pl_association_rate_k = 0.36;
     PCSK9_LDLR_pl_association_rate_k = 0.36;
     LDL_LDLR_en_association_rate_k = 0.36;
     PCSK9_LDLR_en_association_rate_k = 0.36;
     MAb_PC9_2_association_rate_k = 0.36;
     MAb_PC9_2_Kd = 0.6;
     MAb_PC9_2_kel = 0.0075;
     Statin_dose_amount = 0;
     Statin_dose_cycles = 1000;
     MAb_dose_amount = 0;
     MAb_dose_cycles = 100;
     PCSK9_pl_P_uptake_rate_k = 0;
     convert_nmol_to_mol = 1e-09;
     convert_L_to_dL = 10;
     LDLR_internalization_fraction_P = 1;
     MAb_Vd = 6;
     Statin_Vd = 30;
     Statin_Chol_P_IC50 = 0.08;
     MAb_doseX_amount = 0;
     MAb_doseX_start = 0;
     MAb_doseX_interval = 336;
     MAb_doseX_cycles = 1;
     MAb_doseX_duration = 1;
     Chol_er_P_base = 1.7e+06;
     Chol_er_exp = 10;
     Chol_ic_P_base = 1.7e+08;
     Statin_pl_to_pc_rate_k = 3.33;
     Statin_pc_to_pl_rate_k = 0.333;
     Statin_kmet = 1.25;
     StatinM_kel = 0.5;
     StatinM_Vd = 75;
     Fibrate_LPL_Emax = 1;
     Fibrate_LPL_nh = 1;
     Fibrate_LPL_EC50 = 15;
     Statin_doseX_amount = 0;
     Statin_doseX_start = 2016;
     Statin_doseX_interval = 24;
     Statin_doseX_cycles = 1000;
     Statin_doseX_duration = 1;
     Chol_MW = 386.65;
     compartment = 1;
     Conc_MAb_Free = 0;
     Conc_MAb_Tot = 0;
     Conc_Statin = 0;
     Conc_PCSK9 = 4.5273;
     Conc_LDL = 168.15;
     Conc_HDL = 46.15;
     Conc_VLDL = 25.139;
     Conc_nonHDL = 193.29;
     Conc_Chol_Tot = 239.44;
     Conc_ApoB = 1.2511;
     Conc_ApoA1 = 1.5914;
     Conc_PC9_Tot = 4.5273;
     PctCh_PCSK9 = 0;
     PctCh_LDL = 0;
     PctCh_HDL = 0;
     PctCh_VLDL = 0;
     PctCh_nonHDL = 0;
     PctCh_Chol_Tot = 0;
     PctCh_ApoB = 0;
     PctCh_ApoA1 = 0;
     ApoB_ApoA1 = 0.78612;
     TC_HDL = 5.1882;
     Chol_er_P = 1.7782e+06;
     Time_Days = 0;
     
%%     Initial Conditions:
     X(1) = 0;
     X(2) = 0;
     X(3) = 12.45;
     X(4) = 0;
     X(5) = 0;
     X(6) = 0;
     X(7) = 1021.7;
     X(8) = 43765;
     X(9) = 1.563e+05;
     X(10) = 1.7076e+08;
     X(11) = 6680.4;
     X(12) = 1.35;
     X(13) = 1.66;
     X(14) = 0.0718;
     X(15) = 3.4823;
     X(16) = 1.1631;
     X(17) = 0.0164;
     X(18) = 0.59093;
     X(19) = 0.042;
     X(20) = 1.66;
     X(21) = 10.523;
     X(22) = 0.47228;
     X(23) = 0;
     X(24) = 0;
     X(25) = 6833.9;
     X(26) = 0;
     X(27) = 0;
     CETP_pl = 100;
     Source = 0;
     Sink = 0;
     Calculation = 0;
     Base_PCSK9 = 4.5273;
     Base_LDL = 168.15;
     Base_HDL = 46.15;
     Base_Chol_Tot = 239.44;
     Base_nonHDL = 193.29;
     Base_ApoB = 1.2511;
     Base_ApoA1 = 1.5914;
     Trans = 0;
     Base_VLDL = 25.139;
     Conc_Fibrate = 0;

%% equations =

%% 'ODEs:
%      d(X(1))/dt = 1/compartment*(ReactionFlux6 - ReactionFlux7 - ReactionFlux57 - ReactionFlux58 + ReactionFlux59);
%      d(X(2))/dt = 1/compartment*(ReactionFlux1);
%      d(X(3))/dt = 1/compartment*(-ReactionFlux2 + ReactionFlux4 - ReactionFlux16 + ReactionFlux20 - ReactionFlux29 - ReactionFlux52 + ReactionFlux53 - ReactionFlux56);
%      d(X(4))/dt = 1/compartment*(ReactionFlux2 - ReactionFlux3 - ReactionFlux4 - ReactionFlux52 + ReactionFlux53);
%      d(X(5))/dt = 1/compartment*(-ReactionFlux2 + ReactionFlux4 - ReactionFlux5 + ReactionFlux31);
%      d(X(6))/dt = 1/compartment*(-ReactionFlux6 - ReactionFlux30 + ReactionFlux55);
%      d(X(7))/dt = 1/compartment*(-ReactionFlux39 - ReactionFlux45 + ReactionFlux48);
%      d(X(8))/dt = 1/compartment*(-ReactionFlux41 + ReactionFlux44 - ReactionFlux47);
%      d(X(9))/dt = 1/compartment*(-ReactionFlux28);
%      d(X(10))/dt = 1/compartment*(ReactionFlux34 - ReactionFlux35 + ReactionFlux38 - ReactionFlux43 + ReactionFlux46 + ReactionFlux50);
%      d(X(11))/dt = 1/compartment*(-ReactionFlux27);
%      d(X(12))/dt = 1/compartment*(ReactionFlux9 - ReactionFlux13 + ReactionFlux14 - ReactionFlux15 - ReactionFlux16 + ReactionFlux19 + ReactionFlux20);
%      d(X(13))/dt = 1/compartment*(ReactionFlux15 - ReactionFlux19 - ReactionFlux25);
%      d(X(14))/dt = 1/compartment*(ReactionFlux17 - ReactionFlux21 + ReactionFlux25);
%      d(X(15))/dt = 1/compartment*(ReactionFlux13 - ReactionFlux14 - ReactionFlux17 - ReactionFlux18 + ReactionFlux21 + ReactionFlux22 - ReactionFlux23);
%      d(X(16))/dt = 1/compartment*(ReactionFlux8 - ReactionFlux9);
%      d(X(17))/dt = 1/compartment*(ReactionFlux16 - ReactionFlux20 - ReactionFlux26);
%      d(X(18))/dt = 1/compartment*(ReactionFlux18 - ReactionFlux22 + ReactionFlux26 - ReactionFlux33);
%      d(X(19))/dt = 1/compartment*(-ReactionFlux18 + ReactionFlux22 - ReactionFlux24 + ReactionFlux56);
%      d(X(20))/dt = 1/compartment*(-ReactionFlux17 + ReactionFlux21 - ReactionFlux37);
%      d(X(21))/dt = 1/compartment*(ReactionFlux10 - ReactionFlux11 - ReactionFlux12);
%      d(X(22))/dt = 1/compartment*(ReactionFlux12 - ReactionFlux36);
%      d(X(23))/dt = 1/compartment*(-ReactionFlux31 - ReactionFlux32 + ReactionFlux54);
%      d(X(24))/dt = 1/compartment*(-ReactionFlux51 + ReactionFlux52 - ReactionFlux53);
%      d(X(25))/dt = 1/compartment*(-ReactionFlux15 + ReactionFlux19 + ReactionFlux40 + ReactionFlux42 - ReactionFlux49);
%      d(X(26))/dt = 1/compartment*(ReactionFlux57 - ReactionFlux60);
%      d(X(27))/dt = 1/compartment*(ReactionFlux58 - ReactionFlux59);
%      d(X(1))/dt = 1/compartment*(ReactionFlux6 - ReactionFlux7 - ReactionFlux57 - ReactionFlux58 + ReactionFlux59);
     S = sym(zeros(27,60));
     X = sym('X', [1 27]);
     f = sym('f', [62 1]);
%      f(1) = Time_Sim_production_rate_k;
%      f(2) = MAb_PCSK9_association_rate_k;
%      f(3) = MAb_PCSK9_kel;
%      f(4) = MAb_PCSK9_association_rate_k*MAb_PCSK9_Kd;
%      f(5) = MAb_kel;
%      f(6) = Statin_Ka*Statin_F;
%      f(7) = Statin_kel;
%      f(8) = LDLR_ic_P_production_rate_k;
%      f(9) = LDLR_ic_to_cs_P_trafficking_rate_k;
%      f(10) = SREBP_ic_P_production_rate_k;
%      f(11) = SREBP_ic_P_degradation_rate_k;
%      f(12) = SREBP_ic_to_nu_P_activation_rate_k;
%      f(13) = LDLR_P_internalization_rate_k*LDLR_internalization_fraction_P;
%      f(14) = LDLR_P_recycling_rate_k;
%      f(15) = LDL_LDLR_pl_association_rate_k;
%      f(16) = PCSK9_LDLR_pl_association_rate_k;
%      f(17) = LDL_LDLR_en_association_rate_k;
%      f(18) = PCSK9_LDLR_en_association_rate_k;
%      f(19) = LDL_LDLR_pl_association_rate_k;
%      f(20) = PCSK9_LDLR_pl_association_rate_k*PCSK9_LDLR_pl_Kd;
%      f(21) = LDL_LDLR_en_association_rate_k*LDL_LDLR_en_Kd;
%      f(22) = PCSK9_LDLR_en_association_rate_k*PCSK9_LDLR_en_Kd;
%      f(23) = LDLR_en_P_degradation_rate_k;
%      f(24) = PCSK9_en_P_degradation_rate_k;
%      f(25) = LDL_LDLR_P_internalization_rate_k*LDLR_internalization_fraction_P;
%      f(26) = PC9_LDLR_P_internalization_rate_k*LDLR_internalization_fraction_P;
%      f(27) = ApoB_pl_clearance_rate_k;
%      f(28) = ApoA1_pl_clearance_rate_k;
%      f(29) = PCSK9_pl_clearance_rate_k;
%      f(30) = Statin_Ka*(1-Statin_F);
%      f(31) = MAb_Ka*MAb_F;
%      f(32) = MAb_Ka*(1-MAb_F);
%      f(33) = PC9_LDLR_en_P_degradation_rate_k;
%      f(34) = Chol_ic_P_production_rate_k;
%      f(35) = Chol_ic_P_elimination_rate_k;
%      f(36) = SREBP_nu_P_degradation_rate_k;
%      f(37) = LDL_en_to_Chol_ic_P_rate_k;
%      f(38) = LDL_en_to_Chol_ic_P_rate_k*chol_per_LDL_particle;
%      f(39) = VLDL_to_LDL_conversion_rate_k;
%      f(40) = VLDL_to_LDL_conversion_rate_k*VLDL_to_LDL_conversion_rate_k/chol_per_LDL_particle;
%      f(41) = HDL_to_LDL_exchange_rate_k;
%      f(42) = HDL_to_LDL_exchange_rate_k*chol_per_HDL_particle/chol_per_LDL_particle;
%      f(43) = Chol_ic_P_to_HDL_pl_rate_k;
%      f(44) = Chol_ic_P_to_HDL_pl_rate_k/chol_per_HDL_particle;
%      f(45) = VLDL_pl_P_uptake_rate_k;
%      f(46) = VLDL_pl_P_uptake_rate_k*chol_per_VLDL_particle;
%      f(47) = HDL_to_VLDL_exchange_rate_k;
%      f(48) = HDL_to_VLDL_exchange_rate_k*chol_per_HDL_particle/chol_per_VLDL_particle;
%      f(49) = LDL_pl_LDLRind_P_uptake_rate_k;
%      f(50) = LDL_pl_LDLRind_P_uptake_rate_k*chol_per_LDL_particle;
%      f(51) = MAb_PC9_2_kel;
%      f(52) = MAb_PC9_2_association_rate_k;
%      f(53) = MAb_PC9_2_association_rate_k*MAb_PC9_2_Kd;
%      f(54) = 0;
%      f(55) = 0;
%      f(56) = PCSK9_pl_P_uptake_rate_k;
%      f(57) = Statin_kmet;
%      f(58) = Statin_pl_to_pc_rate_k;
%      f(59) = Statin_pc_to_pl_rate_k;
%      f(60) = StatinM_kel;
%      f(61) = VLDL_pl_P_LDLRuptake_rate_k*LDLR_internalization_fraction_P;
%      f(62) = VLDL_pl_P_LDLRuptake_rate_k*LDLR_internalization_fraction_P*chol_per_VLDL_particle;
     
     S(1,6)     = X(6);
     S(1,7)     = -X(1); 
     S(1,57)    = -X(1); 
     S(1,58)    = -X(1); 
     S(1,59)    = X(27);
     S(2,1)     = 1;
     S(3,2)     = -(X(5)/MAb_Vd)*(X(3)/volume_pl)*volume_pl; 
     S(3,4)     = X(4); 
     S(3,16)    = -(X(3)/volume_pl)*(X(12)/volume_P)*volume_P;
     S(3,20)    = X(17); 
     S(3,29)    = -X(3); 
     S(3,52)    = -(X(4)/MAb_Vd)*(X(3)/volume_pl)*volume_pl; 
     S(3,53)    = X(24);
     S(3,56)    = -X(3);
     S(4,2)     = (X(5)/MAb_Vd)*(X(3)/volume_pl)*volume_pl; 
     S(4,3)     = -X(4); 
     S(4,4)     = -X(4); 
     S(4,52)    = -(X(4)/MAb_Vd)*(X(3)/volume_pl)*volume_pl;
     S(4,53)    = X(24); 
     S(5,2)     = -(X(5)/MAb_Vd)*(X(3)/volume_pl)*volume_pl; 
     S(5,4)     = X(4);
     S(5,5)     = -X(5); 
     S(5,31)    = X(23);
     S(6,6)     = -X(6); 
     S(6,30)    = -X(6); 
     S(6,55)    = 0;
     S(7,39)    = -X(7)*(1+Fibrate_LPL_Emax*power(Conc_Fibrate,Fibrate_LPL_nh)/(power(Fibrate_LPL_EC50,Fibrate_LPL_nh)+power(Conc_Fibrate,Fibrate_LPL_nh)));
     S(7,45)    = -X(7); %
     S(7,48)    = X(8)*(weight_ApoB_HDL_VLDL*power(X(11),ApoB_HDL_VLDL_nh)/(power(ApoB_HDL_VLDL_EC50,ApoB_HDL_VLDL_nh)+power(X(11),ApoB_HDL_VLDL_nh)))*(weight_CETP_HDL_VLDL*power(CETP_pl,CETP_HDL_VLDL_nh)/(power(CETP_HDL_VLDL_EC50,CETP_HDL_VLDL_nh)+power(CETP_pl,CETP_HDL_VLDL_nh)));
     S(7,61)    = -X(7)*X(12);
     S(8,41)    = -X(8)*(weight_ApoB_HDL_LDL*power(X(11),ApoB_HDL_LDL_nh)/(power(ApoB_HDL_LDL_EC50,ApoB_HDL_LDL_nh)+power(X(11),ApoB_HDL_LDL_nh)))*(weight_CETP_HDL_LDL*power(CETP_pl,CETP_HDL_LDL_nh)/(power(CETP_HDL_LDL_EC50,CETP_HDL_LDL_nh)+power(CETP_pl,CETP_HDL_LDL_nh)));
     S(8,44)    = X(10)*power(X(9),ApoA1_RCT_nh)/(power(ApoA1_RCT_EC50,ApoA1_RCT_nh)+power(X(9),ApoA1_RCT_nh));
     S(8,47)    = -X(8)*(weight_ApoB_HDL_VLDL*power(X(11),ApoB_HDL_VLDL_nh)/(power(ApoB_HDL_VLDL_EC50,ApoB_HDL_VLDL_nh)+power(X(11),ApoB_HDL_VLDL_nh)))*(weight_CETP_HDL_VLDL*power(CETP_pl,CETP_HDL_VLDL_nh)/(power(CETP_HDL_VLDL_EC50,CETP_HDL_VLDL_nh)+power(CETP_pl,CETP_HDL_VLDL_nh)));
     S(9,28)    = -X(9);
     S(10,34)   = power(X(22),SREBP_Chol_nh)/(power(SREBP_Chol_EC50,SREBP_Chol_nh)+power(X(22),SREBP_Chol_nh))*(1-Statin_Chol_Imax*power(abs(Conc_Statin),Statin_Chol_nh)/(power(Statin_Chol_P_IC50,Statin_Chol_nh)+power(abs(Conc_Statin),Statin_Chol_nh))); 
     S(10,35)   = -X(10);
     S(10,38)   = X(20);
     S(10,43)   = -X(10)*power(X(9),ApoA1_RCT_nh)/(power(ApoA1_RCT_EC50,ApoA1_RCT_nh)+power(X(9),ApoA1_RCT_nh));
     S(10,46)   = X(7);
     S(10,50)   = X(25);
     S(10,62)   = X(7)*X(12); %
     S(11,27)   = X(11);
     S(12,9)    = X(16);
     S(12,13)   = -X(12);
     S(12,14)   = X(15);
     S(12,15)   = -(X(25)/volume_pl)*(X(12)/volume_P)*volume_P;
     S(12,16)   = -(X(3)/volume_pl)*(X(12)/volume_P)*volume_P;
     S(12,19)   = X(13);
     S(12,20)   = X(17);
     S(13,15)   = (X(25)/volume_pl)*(X(12)/volume_P)*volume_P;
     S(13,19)   = -X(13);
     S(13,25)   = -X(13);
     S(14,17)   = (X(20)/volume_en_P)*(X(15)/volume_en_P)*volume_en_P;
     S(14,21)   = -X(14);
     S(14,25)   = X(13);
     S(15,13)   = X(12);
     S(15,14)   = -X(15);
     S(15,17)   = -(X(20)/volume_en_P)*(X(15)/volume_en_P)*volume_en_P;
     S(15,18)   = -(X(19)/volume_en_P)*(X(15)/volume_en_P)*volume_en_P;
     S(15,21)   = X(14);
     S(15,22)   = X(18);
     S(15,23)   = -X(15);
     S(16,8)    = power(X(22),SREBP_LDLR_nh)/(power(SREBP_LDLR_EC50,SREBP_LDLR_nh)+power(X(22),SREBP_LDLR_nh));
     S(16,9)    = -X(16);
     S(17,16)   = (X(3)/volume_pl)*(X(12)/volume_P)*volume_P;
     S(17,20)   = -PCSK9_LDLR_pl_Kd*X(17);
     S(17,26)   = -LDLR_internalization_fraction_P*X(17);
     S(18,18)   = (X(19)/volume_en_P)*(X(15)/volume_en_P)*volume_en_P;
     S(18,22)   = -PCSK9_LDLR_en_Kd*X(18);
     S(18,26)   = LDLR_internalization_fraction_P*X(17);
     S(18,33)   = -X(18);
     S(19,18)   = -(X(19)/volume_en_P)*(X(15)/volume_en_P)*volume_en_P;
     S(19,22)   = PCSK9_LDLR_en_Kd*X(18);
     S(19,24)   = -X(19);
     S(19,56)   = X(3);
     S(20,17)   = -(X(20)/volume_en_P)*(X(15)/volume_en_P)*volume_en_P;
     S(20,21)   = LDL_LDLR_en_Kd*X(14);
     S(20,37)   = -X(20);
     S(21,10)   = 1;
     S(21,11)   = -X(21);
     S(21,12)   = -X(21)*(1-Chol_SREBP_Imax*power(Chol_er_P,Chol_SREBP_nh)/(power(Chol_er_P_base,Chol_SREBP_nh)+power(Chol_er_P,Chol_SREBP_nh)));
     S(22,12)   = X(21)*(1-Chol_SREBP_Imax*power(Chol_er_P,Chol_SREBP_nh)/(power(Chol_er_P_base,Chol_SREBP_nh)+power(Chol_er_P,Chol_SREBP_nh)));
     S(22,36)   = -X(22);
     S(23,31)   = -MAb_F*X(23);
     S(23,32)   = -(1-MAb_F)*X(23);
     S(23,54)   = 0;
     S(24,51)   = -X(24);
     S(24,52)   = (X(4)/MAb_Vd)*(X(3)/volume_pl)*volume_pl;
     S(24,53)   = -MAb_PC9_2_Kd*X(24);
     S(25,15)   = -(X(25)/volume_pl)*(X(12)/volume_P)*volume_P;
     S(25,19)   = LDL_LDLR_pl_Kd*X(13);
     S(25,40)   = X(7)*chol_per_VLDL_particle/chol_per_LDL_particle;
     S(25,42)   = X(8)*chol_per_HDL_particle/chol_per_LDL_particle*(weight_ApoB_HDL_LDL*power(X(11),ApoB_HDL_LDL_nh)/(power(ApoB_HDL_LDL_EC50,ApoB_HDL_LDL_nh)+power(X(11),ApoB_HDL_LDL_nh)))*(weight_CETP_HDL_LDL*power(CETP_pl,CETP_HDL_LDL_nh)/(power(CETP_HDL_LDL_EC50,CETP_HDL_LDL_nh)+power(CETP_pl,CETP_HDL_LDL_nh)));   
     S(25,49)   = -X(25);
     S(26,57)   = X(1);
     S(26,60)   = -X(26);
     S(27,58) = X(1);
     S(27,59) = -X(27);
     
     
%% Sample from fluxex
% a = sym('a', [33 1]);
a = abs(normrnd(0,1,[1,33]));
sample_f = zeros(60,1);
roundn = @(x,n) round(x*10^n)./10^n;
for i = 1:33
    sample_f = sample_f + kerS(:,i) * a(i);
end

%%     Fluxes:
%      ReactionFlux1 = X2_production_rate_k;
%      ReactionFlux2 = MAb_PCSK9_association_rate_k*(X(5)/MAb_Vd)*(X(3)/volume_pl)*volume_pl;
%      ReactionFlux3 = MAb_PCSK9_kel*X(4);
%      ReactionFlux4 = MAb_PCSK9_association_rate_k*MAb_PCSK9_Kd*X(4);
%      ReactionFlux5 = MAb_kel*X(5);
%      ReactionFlux6 = Statin_Ka*Statin_F*X(6);
%      ReactionFlux7 = Statin_kel*X(1);
%      ReactionFlux8 = X16_production_rate_k*power(X(22),SREBP_LDLR_nh)/(power(SREBP_LDLR_EC50,SREBP_LDLR_nh)+power(X(22),SREBP_LDLR_nh));
%      ReactionFlux9 = LDLR_ic_to_cs_P_trafficking_rate_k*X(16);
%      ReactionFlux10 = X21_production_rate_k;
%      ReactionFlux11 = X21_degradation_rate_k*X(21);
%      ReactionFlux12 = SREBP_ic_to_nu_P_activation_rate_k*X(21)*(1-Chol_SREBP_Imax*power(Chol_er_P,Chol_SREBP_nh)/(power(Chol_er_P_base,Chol_SREBP_nh)+power(Chol_er_P,Chol_SREBP_nh)));
%      ReactionFlux13 = LDLR_P_internalization_rate_k*LDLR_internalization_fraction_P*X(12);
%      ReactionFlux14 = LDLR_P_recycling_rate_k*X(15);
%      ReactionFlux15 = LDL_LDLR_pl_association_rate_k*(X(25)/volume_pl)*(X(12)/volume_P)*volume_P;
%      ReactionFlux16 = PCSK9_LDLR_pl_association_rate_k*(X(3)/volume_pl)*(X(12)/volume_P)*volume_P;
%      ReactionFlux17 = LDL_LDLR_en_association_rate_k*(X(20)/volume_en_P)*(X(15)/volume_en_P)*volume_en_P;
%      ReactionFlux18 = PCSK9_LDLR_en_association_rate_k*(X(19)/volume_en_P)*(X(15)/volume_en_P)*volume_en_P;
%      ReactionFlux19 = LDL_LDLR_pl_association_rate_k*LDL_LDLR_pl_Kd*X(13);
%      ReactionFlux20 = PCSK9_LDLR_pl_association_rate_k*PCSK9_LDLR_pl_Kd*X(17);
%      ReactionFlux21 = LDL_LDLR_en_association_rate_k*LDL_LDLR_en_Kd*X(14);
%      ReactionFlux22 = PCSK9_LDLR_en_association_rate_k*PCSK9_LDLR_en_Kd*X(18);
%      ReactionFlux23 = X15_degradation_rate_k*X(15);
%      ReactionFlux24 = X19_degradation_rate_k*X(19);
%      ReactionFlux25 = LDL_LDLR_P_internalization_rate_k*LDLR_internalization_fraction_P*X(13);
%      ReactionFlux26 = PC9_LDLR_P_internalization_rate_k*LDLR_internalization_fraction_P*X(17);
%      ReactionFlux27 = X11_clearance_rate_k*X(11);
%      ReactionFlux28 = X9_clearance_rate_k*X(9);
%      ReactionFlux29 = X3_clearance_rate_k*X(3);
%      ReactionFlux30 = Statin_Ka*(1-Statin_F)*X(6);
%      ReactionFlux31 = MAb_Ka*MAb_F*X(23);
%      ReactionFlux32 = MAb_Ka*(1-MAb_F)*X(23);
%      ReactionFlux33 = X18_degradation_rate_k*X(18);
%      ReactionFlux34 = X10_production_rate_k*power(X(22),SREBP_Chol_nh)/(power(SREBP_Chol_EC50,SREBP_Chol_nh)+power(X(22),SREBP_Chol_nh))*(1-Statin_Chol_Imax*power(abs(Conc_Statin),Statin_Chol_nh)/(power(Statin_Chol_P_IC50,Statin_Chol_nh)+power(abs(Conc_Statin),Statin_Chol_nh)));
%      ReactionFlux35 = X10_elimination_rate_k*X(10);
%      ReactionFlux36 = X22_degradation_rate_k*X(22);
%      ReactionFlux37 = LDL_en_to_X10_rate_k*X(20);
%      ReactionFlux38 = LDL_en_to_X10_rate_k*X(20)*chol_per_LDL_particle;
%      ReactionFlux39 = VLDL_to_LDL_conversion_rate_k*X(7)*(1+Fibrate_LPL_Emax*power(Conc_Fibrate,Fibrate_LPL_nh)/(power(Fibrate_LPL_EC50,Fibrate_LPL_nh)+power(Conc_Fibrate,Fibrate_LPL_nh)));
%      ReactionFlux40 = VLDL_to_LDL_conversion_rate_k*X(7)*chol_per_VLDL_particle/chol_per_LDL_particle;
%      ReactionFlux41 = HDL_to_LDL_exchange_rate_k*X(8)*(weight_ApoB_HDL_LDL*power(X(11),ApoB_HDL_LDL_nh)/(power(ApoB_HDL_LDL_EC50,ApoB_HDL_LDL_nh)+power(X(11),ApoB_HDL_LDL_nh)))*(weight_CETP_HDL_LDL*power(CETP_pl,CETP_HDL_LDL_nh)/(power(CETP_HDL_LDL_EC50,CETP_HDL_LDL_nh)+power(CETP_pl,CETP_HDL_LDL_nh)));
%      ReactionFlux42 = HDL_to_LDL_exchange_rate_k*X(8)*chol_per_HDL_particle/chol_per_LDL_particle*(weight_ApoB_HDL_LDL*power(X(11),ApoB_HDL_LDL_nh)/(power(ApoB_HDL_LDL_EC50,ApoB_HDL_LDL_nh)+power(X(11),ApoB_HDL_LDL_nh)))*(weight_CETP_HDL_LDL*power(CETP_pl,CETP_HDL_LDL_nh)/(power(CETP_HDL_LDL_EC50,CETP_HDL_LDL_nh)+power(CETP_pl,CETP_HDL_LDL_nh)));
%      ReactionFlux43 = X10_to_X8_rate_k*X(10)*power(X(9),ApoA1_RCT_nh)/(power(ApoA1_RCT_EC50,ApoA1_RCT_nh)+power(X(9),ApoA1_RCT_nh));
%      ReactionFlux44 = X10_to_X8_rate_k*X(10)/chol_per_HDL_particle*power(X(9),ApoA1_RCT_nh)/(power(ApoA1_RCT_EC50,ApoA1_RCT_nh)+power(X(9),ApoA1_RCT_nh));
%      ReactionFlux45 = X7_P_uptake_rate_k*X(7) + X7_P_LDLRuptake_rate_k*LDLR_internalization_fraction_P*X(7)*X(12);
%      ReactionFlux46 = (X7_P_uptake_rate_k*X(7)+ X7_P_LDLRuptake_rate_k*LDLR_internalization_fraction_P*X(7)*X(12))*chol_per_VLDL_particle;
%      ReactionFlux47 = HDL_to_VLDL_exchange_rate_k*X(8)*(weight_ApoB_HDL_VLDL*power(X(11),ApoB_HDL_VLDL_nh)/(power(ApoB_HDL_VLDL_EC50,ApoB_HDL_VLDL_nh)+power(X(11),ApoB_HDL_VLDL_nh)))*(weight_CETP_HDL_VLDL*power(CETP_pl,CETP_HDL_VLDL_nh)/(power(CETP_HDL_VLDL_EC50,CETP_HDL_VLDL_nh)+power(CETP_pl,CETP_HDL_VLDL_nh)));
%      ReactionFlux48 = HDL_to_VLDL_exchange_rate_k*X(8)*chol_per_HDL_particle/chol_per_VLDL_particle*(weight_ApoB_HDL_VLDL*power(X(11),ApoB_HDL_VLDL_nh)/(power(ApoB_HDL_VLDL_EC50,ApoB_HDL_VLDL_nh)+power(X(11),ApoB_HDL_VLDL_nh)))*(weight_CETP_HDL_VLDL*power(CETP_pl,CETP_HDL_VLDL_nh)/(power(CETP_HDL_VLDL_EC50,CETP_HDL_VLDL_nh)+power(CETP_pl,CETP_HDL_VLDL_nh)));
%      ReactionFlux49 = X25_LDLRind_P_uptake_rate_k*X(25);
%      ReactionFlux50 = X25_LDLRind_P_uptake_rate_k*X(25)*chol_per_LDL_particle;
%      ReactionFlux51 = MAb_PC9_2_kel*X(24);
%      ReactionFlux52 = MAb_PC9_2_association_rate_k*(X(4)/MAb_Vd)*(X(3)/volume_pl)*volume_pl;
%      ReactionFlux53 = MAb_PC9_2_association_rate_k*MAb_PC9_2_Kd*X(24);
%      ReactionFlux54 = piecewise(0,or(eq(MAb_dose_amount,0),ge(floor((X(2)-MAb_dose_start)/MAb_dose_interval),MAb_dose_cycles)),MAb_dose_amount/MAb_MW/convert_nmol_to_mmol/MAb_dose_duration,and(ge(X(2),MAb_dose_start+ge(X(2),MAb_dose_start)*floor((X(2)-MAb_dose_start)/MAb_dose_interval)*MAb_dose_interval),lt(X(2),MAb_dose_start+MAb_dose_duration+ge(X(2),MAb_dose_start)*floor((X(2)-MAb_dose_start)/MAb_dose_interval)*MAb_dose_interval)),0)+piecewise(0,or(eq(MAb_doseX_amount,0),ge(floor((X(2)-MAb_doseX_start)/MAb_doseX_interval),MAb_doseX_cycles)),MAb_doseX_amount/MAb_MW/convert_nmol_to_mmol/MAb_doseX_duration,and(ge(X(2),MAb_doseX_start+ge(X(2),MAb_doseX_start)*floor((X(2)-MAb_doseX_start)/MAb_doseX_interval)*MAb_doseX_interval),lt(X(2),MAb_doseX_start+MAb_doseX_duration+ge(X(2),MAb_doseX_start)*floor((X(2)-MAb_doseX_start)/MAb_doseX_interval)*MAb_doseX_interval)),0);
%      ReactionFlux55 = piecewise(0,or(eq(Statin_dose_amount,0),ge(floor((X(2)-Statin_dose_start)/Statin_dose_interval),Statin_dose_cycles)),Statin_dose_amount/Statin_MW/convert_nmol_to_mmol/Statin_dose_duration,and(ge(X(2),Statin_dose_start+ge(X(2),Statin_dose_start)*floor((X(2)-Statin_dose_start)/Statin_dose_interval)*Statin_dose_interval),lt(X(2),Statin_dose_start+Statin_dose_duration+ge(X(2),Statin_dose_start)*floor((X(2)-Statin_dose_start)/Statin_dose_interval)*Statin_dose_interval)),0)+piecewise(0,or(eq(Statin_doseX_amount,0),ge(floor((X(2)-Statin_doseX_start)/Statin_doseX_interval),Statin_doseX_cycles)),Statin_doseX_amount/Statin_MW/convert_nmol_to_mmol/Statin_doseX_duration,and(ge(X(2),Statin_doseX_start+ge(X(2),Statin_doseX_start)*floor((X(2)-Statin_doseX_start)/Statin_doseX_interval)*Statin_doseX_interval),lt(X(2),Statin_doseX_start+Statin_doseX_duration+ge(X(2),Statin_doseX_start)*floor((X(2)-Statin_doseX_start)/Statin_doseX_interval)*Statin_doseX_interval)),0);
%      ReactionFlux56 = X3_P_uptake_rate_k*X(3);
%      ReactionFlux57 = Statin_kmet*X(1);
%      ReactionFlux58 = X1_to_pc_rate_k*X(1);
%      ReactionFlux59 = X27_to_pl_rate_k*X(27);
%      ReactionFlux60 = StatinM_kel*X(26);
