x = sym('x', [27 1]);
f = sym('f', [54 1]);
v = sym('v', [3 1]);
k = sym('k', [3 1]);
p = sym('p', [35 1]);
c = sym('c', [2 1]);

%% S4 remove all entries contains 1,3,4,5,22,23,25,26
% S4 = sym('S4', [26 54]);
     S4(2,28)     = -x(2); 
     S4(2,48)     = -x(2); 
     
     S4(1,51)     = 0;
     S4(1,49)     = 0; 
     S4(1,6)      = 0; 
     S4(1,50)     = 0; 
     S4(1,5)      = 0;
     
     S4(2,3)      = 0; 
     S4(2,45)     = 0; 
     S4(2,17)     = x(16); 
     S4(2,16)     = -(x(11)*x(2))/v(1);
     S4(2,2)      = 0;
     S4(2,44)     = 0;
     S4(3,45)     = 0;
     S4(3,3)      = 0; 
     S4(3,1)      = 0;
     S4(3,2)      = 0;
     S4(3,44)     = 0;
     S4(4,30)     = 0;
     S4(4,4)      = 0;
     S4(4,3)      = 0;
     S4(4,2)      = 0;
     S4(5,5)      = 0; 
     S4(5,29)     = 0;
     S4(5,47)     = 1;
     S4(6,41)     = (x(10)^p(6)*x(27)^p(10)*x(7)*k(1)*p(30)*p(28))/(k(2)*(x(10)^p(6) + p(5)^p(6))*(x(27)^p(10) + p(9)^p(10)));
     S4(6,37)     = -x(6)*((c(2)^p(18)*p(17))/(c(2)^p(18) + p(16)^p(18)) + 1);
     S4(6,53)     = -x(11)*p(19)*x(6);
     S4(6,40)     = -x(6);
     S4(7,39)     = (x(8)^p(2)*x(9))/(k(1)*(x(8)^p(2) + p(1)^p(2)));
     S4(7,38)     = -(x(10)^p(4)*x(27)^p(8)*x(7)*p(29)*p(27))/((x(10)^p(4) + p(3)^p(4))*(x(27)^p(8) + p(7)^p(8)));
     S4(7,41)     = -(x(10)^p(6)*x(27)^p(10)*x(7)*p(30)*p(28))/((x(10)^p(6) + p(5)^p(6))*(x(27)^p(10) + p(9)^p(10)));
     S4(8,27)     = -x(8);
     S4(9,40)    = k(2)*x(6);
     S4(9,53)    = x(11)*p(19)*x(6);
     S4(9,34)    = -x(9);
     S4(9,36)    = x(19)*k(3);
     S4(9,42)    = x(24)*k(3);
     S4(9,39)    = -(x(8)^p(2)*x(9))/(x(8)^p(2) + p(1)^p(2));
     S4(9,33)    = -(x(21)^p(21)*((p(24)*abs(c(1))^p(25))/(p(26)^p(25) + abs(c(1))^p(25)) - 1))/(x(21)^p(21) + p(20)^p(21));
     S4(10,26)    = -x(10);
     S4(11,13)    = x(14);
     S4(11,8)    = x(15);
     S4(11,15)    = x(12);
     S4(11,12)    = -x(11)*p(19);
     S4(11,17)    = x(16);
     S4(11,14)    = -(x(24)*x(11))/v(1);
     S4(11,16)    = -(x(11)*x(2))/v(1);
     S4(12,14)    = (x(24)*x(11))/v(1);
     S4(12,24)    = -x(12)*p(19);
     S4(12,15)    = -x(12);
     S4(13,24)    = x(12)*p(19);
     S4(13,19)    = -x(13);
     S4(13,18)    = (x(19)*x(14))/v(3);
     S4(14,19)    =x(13);
     S4(14,22)    = -x(14);
     S4(14,13)    = -x(14);
     S4(14,12)    = x(11)*p(19) ;
     S4(14,21)    = x(17);
     S4(14,18)    = -(x(19)*x(14))/v(3) ;
     S4(14,20)    = -(x(14)*x(18))/v(3);
     S4(15,7)     = (x(21)^p(23))/(x(21)^p(23) + p(22)^p(23));
     S4(15,8)    = -x(15);
     S4(16,16)    = (x(11)*x(2))/v(1);
     S4(16,17)    = -x(16);
     S4(16,25)    = -p(19)*x(16);
     S4(17,25)    = p(19)*x(16);
     S4(17,32)    = -x(17);
     S4(17,21)    = -x(17);
     S4(17,20)    = (x(14)*x(18))/v(3);
     S4(18,48)    = x(2);
     S4(18,23)    = -x(18);
     S4(18,21)    = x(17);
     S4(18,20)    = -(x(14)*x(18))/v(3);
     S4(19,19)    = x(13) ;
     S4(19,36)    = -x(19);
     S4(19,18)    = -(x(19)*x(14))/v(3);
     S4(20,9)    = 1;
     S4(20,10)    = -x(20);
     S4(20,11)    = x(20)*((p(35)^p(15)*p(14))/(p(35)^p(15) + p(12)^p(15)) - 1);
     S4(21,35)    = -x(21);
     S4(21,11)    = -x(20)*((p(35)^p(15)*p(14))/(p(35)^p(15) + p(12)^p(15)) - 1);
     S4(22,30)    = 0;
     S4(22,31)    = 0;
     S4(22,46)    = 1;
     S4(23,44)    = 0;
     S4(23,45)    = 0;
     S4(23,43)    = 0;
     S4(24,15)    = x(12);
     S4(24,42)    = -x(24);
     S4(24,14)    = -(x(24)*x(11))/v(1);
     S4(24,37)    = (x(6)*k(2))/k(3);
     S4(24,38)    = (x(10)^p(4)*x(27)^p(8)*x(7)*k(1)*p(29)*p(27))/(k(3)*(x(10)^p(4) + p(3)^p(4))*(x(27)^p(8) + p(7)^p(8)));
     S4(25,49)    = 0;
     S4(25,52)    = 0;
     S4(26,50)    = 0;
     S4(26,51)    = 0;
     
a = sym('a', [33 1]);
ker_fluxes4 = 0;
ker4 = null(S4);
size(ker4)
for i = 1:33
%     ker_fluxes = ker_fluxes + a(i) * transpose(ker)(1:56,i);
    ker_fluxes4 = ker_fluxes4 + ker4(1:53,i)*a(i);
end
     
% ker_fluxes4 =
ker(1) = a1;
ker(2) = a2;
ker(3) = a3;
ker(4) = a4;
ker(5) = a5;
ker(6) = a6;
ker(7) = (a13*x14*(p22^p23 + x21^p23))/x21^p23 + (a18*x17*(p22^p23 + x21^p23))/x21^p23;
ker(8) = (a13*x14)/x15 + (a18*x17)/x15;
ker(9) = a7*x20 + a20*x21;
ker(10) = a7;
ker(11) = (a20*x21*(p12^p15 + p35^p15))/(x20*(p12^p15 - p14*p35^p15 + p35^p15));
ker(12) = (a14*x2)/(p19*x11) + (a8*x14)/(p19*x11) + (a13*x14)/(p19*x11) + (a28*x2)/(p19*x11) + (a18*x17)/(p19*x11) + (a24*x24)/(p19*x11) + (a33*k2*x6*(c2^p18 + p16^p18))/(k3*(c2^p18*p17 + c2^p18 + p16^p18)) - (a21*x8^p2*x9)/(k3*p19*x11*(p1^p2 + x8^p2)) + (a22*k2*x6*(c2^p18 + p16^p18))/(k3*p19*x11*(c2^p18*p17 + c2^p18 + p16^p18)) + (a23*c2^p18*k1*p17*p28*p30*x7*x10^p6*x27^p10)/(k3*p19*x11*(p5^p6 + x10^p6)*(p9^p10 + x27^p10)*(c2^p18*p17 + c2^p18 + p16^p18));
ker(13) = a8;
ker(14) = (a9*v1*x12)/(x11*x24) - (a24*v1)/x11 + (a21*v1*x8^p2*x9)/(k3*x11*x24*(p1^p2 + x8^p2)) - (a33*k2*p19*v1*x6*(c2^p18 + p16^p18))/(k3*x24*(c2^p18*p17 + c2^p18 + p16^p18)) - (a22*k2*v1*x6*(c2^p18 + p16^p18))/(k3*x11*x24*(c2^p18*p17 + c2^p18 + p16^p18)) - (a23*c2^p18*k1*p17*p28*p30*v1*x7*x10^p6*x27^p10)/(k3*x11*x24*(p5^p6 + x10^p6)*(p9^p10 + x27^p10)*(c2^p18*p17 + c2^p18 + p16^p18));
ker(15) = a9;
ker(16) = (a10*v1*x16)/(x2*x11) - (a28*v1)/x11 - (a14*v1)/x11;
ker(17) = a10;
ker(18) = (a11*v3*x13)/(x14*x19) + (a24*v3*x24)/(x14*x19) - (a21*v3*x8^p2*x9)/(k3*x14*x19*(p1^p2 + x8^p2)) + (a22*k2*v3*x6*(c2^p18 + p16^p18))/(k3*x14*x19*(c2^p18*p17 + c2^p18 + p16^p18)) + (a33*k2*p19*v3*x6*x11*(c2^p18 + p16^p18))/(k3*x14*x19*(c2^p18*p17 + c2^p18 + p16^p18)) + (a23*c2^p18*k1*p17*p28*p30*v3*x7*x10^p6*x27^p10)/(k3*x14*x19*(p5^p6 + x10^p6)*(p9^p10 + x27^p10)*(c2^p18*p17 + c2^p18 + p16^p18));
ker(19) = a11;
ker(20) = (a14*v3*x2)/(x14*x18) + (a12*v3*x17)/(x14*x18) + (a28*v3*x2)/(x14*x18) + (a18*v3*x17)/(x14*x18);
ker(21) = a12;
ker(22) = a13;
ker(23) = - (a14*x2)/x18 - (a18*x17)/x18;
ker(24) = (a21*x8^p2*x9)/(k3*p19*x12*(p1^p2 + x8^p2)) - (a24*x24)/(p19*x12) - (a22*k2*x6*(c2^p18 + p16^p18))/(k3*p19*x12*(c2^p18*p17 + c2^p18 + p16^p18)) - (a33*k2*x6*x11*(c2^p18 + p16^p18))/(k3*x12*(c2^p18*p17 + c2^p18 + p16^p18)) - (a23*c2^p18*k1*p17*p28*p30*x7*x10^p6*x27^p10)/(k3*p19*x12*(p5^p6 + x10^p6)*(p9^p10 + x27^p10)*(c2^p18*p17 + c2^p18 + p16^p18));
ker(25) = - (a14*x2)/(p19*x16) - (a28*x2)/(p19*x16);
ker(26) = 0;
ker(27) = 0;
ker(28) = a14;
ker(29) = a15;
ker(30) = a16;
ker(31) = a17;
ker(32) = a18;
ker(33) = (a19*x9*(p26^p25 + abs(c1)^p25)*(p20^p21 + x21^p21))/(x21^p21*(p26^p25 - p24*abs(c1)^p25 + abs(c1)^p25)) - (a22*c2^p18*k2*p17*x6*(p26^p25 + abs(c1)^p25)*(p20^p21 + x21^p21))/(x21^p21*(p26^p25 - p24*abs(c1)^p25 + abs(c1)^p25)*(c2^p18*p17 + c2^p18 + p16^p18)) - (a33*p19*x6*x11*(p26^p25 + abs(c1)^p25)*(p20^p21 + x21^p21)*(c2^p18*p17 - k2*p16^p18 + c2^p18 + p16^p18 - c2^p18*k2))/(x21^p21*(p26^p25 - p24*abs(c1)^p25 + abs(c1)^p25)*(c2^p18*p17 + c2^p18 + p16^p18)) + (a23*c2^p18*k1*p17*p28*p30*x7*x10^p6*x27^p10*(p26^p25 + abs(c1)^p25)*(p20^p21 + x21^p21))/(x21^p21*(p5^p6 + x10^p6)*(p9^p10 + x27^p10)*(p26^p25 - p24*abs(c1)^p25 + abs(c1)^p25)*(c2^p18*p17 + c2^p18 + p16^p18));
ker(34) = a19;
ker(35) = a20;
ker(36) = (a21*x8^p2*x9)/(k3*x19*(p1^p2 + x8^p2)) - (a24*x24)/x19 - (a22*k2*x6*(c2^p18 + p16^p18))/(k3*x19*(c2^p18*p17 + c2^p18 + p16^p18)) - (a33*k2*p19*x6*x11*(c2^p18 + p16^p18))/(k3*x19*(c2^p18*p17 + c2^p18 + p16^p18)) - (a23*c2^p18*k1*p17*p28*p30*x7*x10^p6*x27^p10)/(k3*x19*(p5^p6 + x10^p6)*(p9^p10 + x27^p10)*(c2^p18*p17 + c2^p18 + p16^p18));
ker(37) = (a23*k1*p28*p30*x7*x10^p6*x27^p10*(c2^p18 + p16^p18))/(k2*x6*(p5^p6 + x10^p6)*(p9^p10 + x27^p10)*(c2^p18*p17 + c2^p18 + p16^p18)) - (a33*p19*x11*(c2^p18 + p16^p18))/(c2^p18*p17 + c2^p18 + p16^p18) - (a22*(c2^p18 + p16^p18))/(c2^p18*p17 + c2^p18 + p16^p18);
ker(38) = (a21*x8^p2*x9*(p3^p4 + x10^p4)*(p7^p8 + x27^p8))/(k1*p27*p29*x7*x10^p4*x27^p8*(p1^p2 + x8^p2)) - (a23*p28*p30*x10^p6*x27^p10*(p3^p4 + x10^p4)*(p7^p8 + x27^p8))/(p27*p29*x10^p4*x27^p8*(p5^p6 + x10^p6)*(p9^p10 + x27^p10));
ker(39) = a21;
ker(40) = a22;
ker(41) = a23;
ker(42) = a24;
ker(43) = a25;
ker(44) = a26;
ker(45) = a27;
ker(46) = 0;
ker(47) = 0;
ker(48) = a28;
ker(49) = a29;
ker(50) = a30;
ker(51) = a31;
ker(52) = a32;
ker(53) = a33;


