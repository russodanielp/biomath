%% remove
%  x1 x3 x4 x5 x22 x23 x25 x26
%% S = 
x = sym('x', [27 1]);
f = sym('f', [54 1]);
v = sym('v', [3 1]);
k = sym('k', [3 1]);
p = sym('p', [35 1]);
c = sym('c', [2 1]);
     S(1,51)     = x(26);
     S(1,49)     = -x(1); 
     S(1,6)      = -x(1); 
     S(1,50)     = -x(1); 
     S(1,5)      = x(5);
     
     S(2,3)      = x(3); 
     S(2,28)     = -x(2); 
     S(2,48)     = -x(2); 
     S(2,45)     = x(23); 
     S(2,17)     = x(16); 
     S(2,16)     = -(x(11)*x(2))/v(1) ;
     S(2,2)      = -(x(4)*x(2))/p(34);
     S(2,44)     = -(x(3)*x(2))/p(34);
     S(3,45)     = x(23);
     S(3,3)      = -x(3); 
     S(3,1)      = -x(3);
     S(3,2)      = (x(4)*x(2))/p(34) ;
     S(3,44)     = -(x(3)*x(2))/p(34);
     S(4,30)     = x(22);
     S(4,4)      = -x(4);
     S(4,3)      = x(3);
     S(4,2)      = -(x(4)*x(2))/p(34);
     S(5,5)      = -x(5); 
     S(5,29)     = -x(5);
     S(5,47)     = 1;
     S(6,41)     = (x(10)^p(6)*x(27)^p(10)*x(7)*k(1)*p(30)*p(28))/(k(2)*(x(10)^p(6) + p(5)^p(6))*(x(27)^p(10) + p(9)^p(10)));
     S(6,37)     = -x(6)*((c(2)^p(18)*p(17))/(c(2)^p(18) + p(16)^p(18)) + 1);
     S(6,53)     = -x(11)*p(19)*x(6);
     S(6,40)     = -x(6);
     S(7,39)     = (x(8)^p(2)*x(9))/(k(1)*(x(8)^p(2) + p(1)^p(2)));
     S(7,38)     = -(x(10)^p(4)*x(27)^p(8)*x(7)*p(29)*p(27))/((x(10)^p(4) + p(3)^p(4))*(x(27)^p(8) + p(7)^p(8)));
     S(7,41)     = -(x(10)^p(6)*x(27)^p(10)*x(7)*p(30)*p(28))/((x(10)^p(6) + p(5)^p(6))*(x(27)^p(10) + p(9)^p(10)));
     S(8,27)     = -x(8);
     S(9,40)    = k(2)*x(6);
     S(9,53)    = x(11)*p(19)*x(6);
     S(9,34)    = -x(9);
     S(9,36)    = x(19)*k(3);
     S(9,42)    = x(24)*k(3);
     S(9,39)    = -(x(8)^p(2)*x(9))/(x(8)^p(2) + p(1)^p(2));
     S(9,33)    = -(x(21)^p(21)*((p(24)*abs(c(1))^p(25))/(p(26)^p(25) + abs(c(1))^p(25)) - 1))/(x(21)^p(21) + p(20)^p(21));
     S(10,26)    = -x(10);
     S(11,13)    = x(14);
     S(11,8)    = x(15);
     S(11,15)    = x(12);
     S(11,12)    = -x(11)*p(19);
     S(11,17)    = x(16);
     S(11,14)    = -(x(24)*x(11))/v(1);
     S(11,16)    = -(x(11)*x(2))/v(1);
     S(12,14)    = (x(24)*x(11))/v(1);
     S(12,24)    = -x(12)*p(19);
     S(12,15)    = -x(12);
     S(13,24)    = x(12)*p(19);
     S(13,19)    = -x(13);
     S(13,18)    = (x(19)*x(14))/v(3);
     S(14,19)    =x(13);
     S(14,22)    = -x(14);
     S(14,13)    = -x(14);
     S(14,12)    = x(11)*p(19) ;
     S(14,21)    = x(17);
     S(14,18)    = -(x(19)*x(14))/v(3) ;
     S(14,20)    = -(x(14)*x(18))/v(3);
     S(15,7)     = (x(21)^p(23))/(x(21)^p(23) + p(22)^p(23));
     S(15,8)    = -x(15);
     S(16,16)    = (x(11)*x(2))/v(1);
     S(16,17)    = -x(16);
     S(16,25)    = -p(19)*x(16);
     S(17,25)    = p(19)*x(16);
     S(17,32)    = -x(17);
     S(17,21)    = -x(17);
     S(17,20)    = (x(14)*x(18))/v(3);
     S(18,48)    = x(2);
     S(18,23)    = -x(18);
     S(18,21)    = x(17);
     S(18,20)    = -(x(14)*x(18))/v(3);
     S(19,19)    = x(13) ;
     S(19,36)    = -x(19);
     S(19,18)    = -(x(19)*x(14))/v(3);
     S(20,9)    = 1;
     S(20,10)    = -x(20);
     S(20,11)    = x(20)*((p(35)^p(15)*p(14))/(p(35)^p(15) + p(12)^p(15)) - 1);
     S(21,35)    = -x(21);
     S(21,11)    = -x(20)*((p(35)^p(15)*p(14))/(p(35)^p(15) + p(12)^p(15)) - 1);
     S(22,30)    = -x(22);
     S(22,31)    = -x(22);
     S(22,46)    = 1;
     S(23,44)    = (x(3)*x(2))/p(34);
     S(23,45)    = -x(23);
     S(23,43)    = -x(23);
     S(24,15)    = x(12);
     S(24,42)    = -x(24);
     S(24,14)    = -(x(24)*x(11))/v(1);
     S(24,37)    = (x(6)*k(2))/k(3);
     S(24,38)    = (x(10)^p(4)*x(27)^p(8)*x(7)*k(1)*p(29)*p(27))/(k(3)*(x(10)^p(4) + p(3)^p(4))*(x(27)^p(8) + p(7)^p(8)));
     S(25,49)    = x(1);
     S(25,52)    = -x(25);
     S(26,50)    = x(1);
     S(26,51)    = -x(26);

% S =... 
% [   0,            0,   0,   0,  x5, -x1,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,   0,    0,    0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0,            0,    0, 0, 0,   0, -x1, -x1,  x26,    0,           0
%    0, -(x2*x4)/p34,  x3,   0,   0,   0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0, -(x2*x11)/v1,  x16,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0, -x2,   0,    0,    0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0, -(x2*x3)/p34,  x23, 0, 0, -x2,   0,   0,    0,    0,           0
%  -x3,  (x2*x4)/p34, -x3,   0,   0,   0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,   0,    0,    0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0, -(x2*x3)/p34,  x23, 0, 0,   0,   0,   0,    0,    0,           0
%    0, -(x2*x4)/p34,  x3, -x4,   0,   0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,   0,  x22,    0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0,            0,    0, 0, 0,   0,   0,   0,    0,    0,           0
%    0,            0,   0,   0, -x5,   0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0, -x5,    0,    0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0,            0,    0, 0, 1,   0,   0,   0,    0,    0,           0
%    0,            0,   0,   0,   0,   0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,   0,    0,    0,    0,                                                                              0,   0,    0,      0, -x6*((c2^p18*p17)/(c2^p18 + p16^p18) + 1),                                                                    0,                               0,   -x6, (k1*p28*p30*x7*x10^p6*x27^p10)/(k2*(p5^p6 + x10^p6)*(p9^p10 + x27^p10)),      0,    0,            0,    0, 0, 0,   0,   0,   0,    0,    0, -p19*x6*x11
%    0,            0,   0,   0,   0,   0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,   0,    0,    0,    0,                                                                              0,   0,    0,      0,                                         0,      -(p27*p29*x7*x10^p4*x27^p8)/((p3^p4 + x10^p4)*(p7^p8 + x27^p8)), (x8^p2*x9)/(k1*(p1^p2 + x8^p2)),     0,      -(p28*p30*x7*x10^p6*x27^p10)/((p5^p6 + x10^p6)*(p9^p10 + x27^p10)),      0,    0,            0,    0, 0, 0,   0,   0,   0,    0,    0,           0
%    0,            0,   0,   0,   0,   0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0, -x8,   0,   0,    0,    0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0,            0,    0, 0, 0,   0,   0,   0,    0,    0,           0
%    0,            0,   0,   0,   0,   0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,   0,    0,    0,    0, -(x21^p21*((p24*abs(c1)^p25)/(p26^p25 + abs(c1)^p25) - 1))/(p20^p21 + x21^p21), -x9,    0, k3*x19,                                         0,                                                                    0,     -(x8^p2*x9)/(p1^p2 + x8^p2), k2*x6,                                                                       0, k3*x24,    0,            0,    0, 0, 0,   0,   0,   0,    0,    0,  p19*x6*x11
%    0,            0,   0,   0,   0,   0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0, -x10,   0,   0,   0,    0,    0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0,            0,    0, 0, 0,   0,   0,   0,    0,    0,           0
%    0,            0,   0,   0,   0,   0,                           0,  x15, 0,    0,                                            0, -p19*x11,  x14, -(x11*x24)/v1,  x12, -(x2*x11)/v1,  x16,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,   0,    0,    0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0,            0,    0, 0, 0,   0,   0,   0,    0,    0,           0
%    0,            0,   0,   0,   0,   0,                           0,    0, 0,    0,                                            0,        0,    0,  (x11*x24)/v1, -x12,            0,    0,             0,    0,             0,    0,    0,    0, -p19*x12,        0,    0,   0,   0,   0,    0,    0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0,            0,    0, 0, 0,   0,   0,   0,    0,    0,           0
%    0,            0,   0,   0,   0,   0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,  (x14*x19)/v3, -x13,             0,    0,    0,    0,  p19*x12,        0,    0,   0,   0,   0,    0,    0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0,            0,    0, 0, 0,   0,   0,   0,    0,    0,           0
%    0,            0,   0,   0,   0,   0,                           0,    0, 0,    0,                                            0,  p19*x11, -x14,             0,    0,            0,    0, -(x14*x19)/v3,  x13, -(x14*x18)/v3,  x17, -x14,    0,        0,        0,    0,   0,   0,   0,    0,    0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0,            0,    0, 0, 0,   0,   0,   0,    0,    0,           0
%    0,            0,   0,   0,   0,   0, x21^p23/(p22^p23 + x21^p23), -x15, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,   0,    0,    0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0,            0,    0, 0, 0,   0,   0,   0,    0,    0,           0
%    0,            0,   0,   0,   0,   0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,  (x2*x11)/v1, -x16,             0,    0,             0,    0,    0,    0,        0, -p19*x16,    0,   0,   0,   0,    0,    0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0,            0,    0, 0, 0,   0,   0,   0,    0,    0,           0
%    0,            0,   0,   0,   0,   0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,  (x14*x18)/v3, -x17,    0,    0,        0,  p19*x16,    0,   0,   0,   0,    0,    0, -x17,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0,            0,    0, 0, 0,   0,   0,   0,    0,    0,           0
%    0,            0,   0,   0,   0,   0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0, -(x14*x18)/v3,  x17,    0, -x18,        0,        0,    0,   0,   0,   0,    0,    0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0,            0,    0, 0, 0,  x2,   0,   0,    0,    0,           0
%    0,            0,   0,   0,   0,   0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0, -(x14*x19)/v3,  x13,             0,    0,    0,    0,        0,        0,    0,   0,   0,   0,    0,    0,    0,                                                                              0,   0,    0,   -x19,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0,            0,    0, 0, 0,   0,   0,   0,    0,    0,           0
%    0,            0,   0,   0,   0,   0,                           0,    0, 1, -x20,  x20*((p14*p35^p15)/(p12^p15 + p35^p15) - 1),        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,   0,    0,    0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0,            0,    0, 0, 0,   0,   0,   0,    0,    0,           0
%    0,            0,   0,   0,   0,   0,                           0,    0, 0,    0, -x20*((p14*p35^p15)/(p12^p15 + p35^p15) - 1),        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,   0,    0,    0,    0,                                                                              0,   0, -x21,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0,            0,    0, 0, 0,   0,   0,   0,    0,    0,           0
%    0,            0,   0,   0,   0,   0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,   0, -x22, -x22,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0,            0,    0, 1, 0,   0,   0,   0,    0,    0,           0
%    0,            0,   0,   0,   0,   0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,   0,    0,    0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0, -x23,  (x2*x3)/p34, -x23, 0, 0,   0,   0,   0,    0,    0,           0
%    0,            0,   0,   0,   0,   0,                           0,    0, 0,    0,                                            0,        0,    0, -(x11*x24)/v1,  x12,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,   0,    0,    0,    0,                                                                              0,   0,    0,      0,                                (k2*x6)/k3, (k1*p27*p29*x7*x10^p4*x27^p8)/(k3*(p3^p4 + x10^p4)*(p7^p8 + x27^p8)),                               0,     0,                                                                       0,   -x24,    0,            0,    0, 0, 0,   0,   0,   0,    0,    0,           0
%    0,            0,   0,   0,   0,   0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,   0,    0,    0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0,            0,    0, 0, 0,   0,  x1,   0,    0, -x25,           0
%    0,            0,   0,   0,   0,   0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,   0,    0,    0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,    0,            0,    0, 0, 0,   0,   0,  x1, -x26,    0,           0];

%% S1 remove rows [1,3,4,5,22,23,25,26]
S1 = S([2,6:21,24] , : );
% S1 =
%  
% [ 0, -(x2*x4)/p34, x3, 0, 0, 0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0, -(x2*x11)/v1,  x16,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0, -x2, 0, 0, 0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0, 0, -(x2*x3)/p34, x23, 0, 0, -x2, 0, 0, 0, 0,           0]
% [ 0,            0,  0, 0, 0, 0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0, 0, 0, 0,    0,                                                                              0,   0,    0,      0, -x6*((c2^p18*p17)/(c2^p18 + p16^p18) + 1),                                                                    0,                               0,   -x6, (k1*p28*p30*x7*x10^p6*x27^p10)/(k2*(p5^p6 + x10^p6)*(p9^p10 + x27^p10)),      0, 0,            0,   0, 0, 0,   0, 0, 0, 0, 0, -p19*x6*x11]
% [ 0,            0,  0, 0, 0, 0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0, 0, 0, 0,    0,                                                                              0,   0,    0,      0,                                         0,      -(p27*p29*x7*x10^p4*x27^p8)/((p3^p4 + x10^p4)*(p7^p8 + x27^p8)), (x8^p2*x9)/(k1*(p1^p2 + x8^p2)),     0,      -(p28*p30*x7*x10^p6*x27^p10)/((p5^p6 + x10^p6)*(p9^p10 + x27^p10)),      0, 0,            0,   0, 0, 0,   0, 0, 0, 0, 0,           0]
% [ 0,            0,  0, 0, 0, 0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0, -x8,   0, 0, 0, 0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0, 0,            0,   0, 0, 0,   0, 0, 0, 0, 0,           0]
% [ 0,            0,  0, 0, 0, 0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0, 0, 0, 0,    0, -(x21^p21*((p24*abs(c1)^p25)/(p26^p25 + abs(c1)^p25) - 1))/(p20^p21 + x21^p21), -x9,    0, k3*x19,                                         0,                                                                    0,     -(x8^p2*x9)/(p1^p2 + x8^p2), k2*x6,                                                                       0, k3*x24, 0,            0,   0, 0, 0,   0, 0, 0, 0, 0,  p19*x6*x11]
% [ 0,            0,  0, 0, 0, 0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0, -x10,   0,   0, 0, 0, 0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0, 0,            0,   0, 0, 0,   0, 0, 0, 0, 0,           0]
% [ 0,            0,  0, 0, 0, 0,                           0,  x15, 0,    0,                                            0, -p19*x11,  x14, -(x11*x24)/v1,  x12, -(x2*x11)/v1,  x16,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0, 0, 0, 0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0, 0,            0,   0, 0, 0,   0, 0, 0, 0, 0,           0]
% [ 0,            0,  0, 0, 0, 0,                           0,    0, 0,    0,                                            0,        0,    0,  (x11*x24)/v1, -x12,            0,    0,             0,    0,             0,    0,    0,    0, -p19*x12,        0,    0,   0,   0, 0, 0, 0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0, 0,            0,   0, 0, 0,   0, 0, 0, 0, 0,           0]
% [ 0,            0,  0, 0, 0, 0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,  (x14*x19)/v3, -x13,             0,    0,    0,    0,  p19*x12,        0,    0,   0,   0, 0, 0, 0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0, 0,            0,   0, 0, 0,   0, 0, 0, 0, 0,           0]
% [ 0,            0,  0, 0, 0, 0,                           0,    0, 0,    0,                                            0,  p19*x11, -x14,             0,    0,            0,    0, -(x14*x19)/v3,  x13, -(x14*x18)/v3,  x17, -x14,    0,        0,        0,    0,   0,   0, 0, 0, 0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0, 0,            0,   0, 0, 0,   0, 0, 0, 0, 0,           0]
% [ 0,            0,  0, 0, 0, 0, x21^p23/(p22^p23 + x21^p23), -x15, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0, 0, 0, 0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0, 0,            0,   0, 0, 0,   0, 0, 0, 0, 0,           0]
% [ 0,            0,  0, 0, 0, 0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,  (x2*x11)/v1, -x16,             0,    0,             0,    0,    0,    0,        0, -p19*x16,    0,   0,   0, 0, 0, 0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0, 0,            0,   0, 0, 0,   0, 0, 0, 0, 0,           0]
% [ 0,            0,  0, 0, 0, 0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,  (x14*x18)/v3, -x17,    0,    0,        0,  p19*x16,    0,   0,   0, 0, 0, 0, -x17,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0, 0,            0,   0, 0, 0,   0, 0, 0, 0, 0,           0]
% [ 0,            0,  0, 0, 0, 0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0, -(x14*x18)/v3,  x17,    0, -x18,        0,        0,    0,   0,   0, 0, 0, 0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0, 0,            0,   0, 0, 0,  x2, 0, 0, 0, 0,           0]
% [ 0,            0,  0, 0, 0, 0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0, -(x14*x19)/v3,  x13,             0,    0,    0,    0,        0,        0,    0,   0,   0, 0, 0, 0,    0,                                                                              0,   0,    0,   -x19,                                         0,                                                                    0,                               0,     0,                                                                       0,      0, 0,            0,   0, 0, 0,   0, 0, 0, 0, 0,           0]
% [ 0,            0,  0, 0, 0, 0,                           0,    0, 1, -x20,  x20*((p14*p35^p15)/(p12^p15 + p35^p15) - 1),        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0, 0, 0, 0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0, 0,            0,   0, 0, 0,   0, 0, 0, 0, 0,           0]
% [ 0,            0,  0, 0, 0, 0,                           0,    0, 0,    0, -x20*((p14*p35^p15)/(p12^p15 + p35^p15) - 1),        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0, 0, 0, 0,    0,                                                                              0,   0, -x21,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0, 0,            0,   0, 0, 0,   0, 0, 0, 0, 0,           0]
% [ 0,            0,  0, 0, 0, 0,                           0,    0, 0,    0,                                            0,        0,    0, -(x11*x24)/v1,  x12,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0, 0, 0, 0,    0,                                                                              0,   0,    0,      0,                                (k2*x6)/k3, (k1*p27*p29*x7*x10^p4*x27^p8)/(k3*(p3^p4 + x10^p4)*(p7^p8 + x27^p8)),                               0,     0,                                                                       0,   -x24, 0,            0,   0, 0, 0,   0, 0, 0, 0, 0,           0]

%% S2 remove columns [1,4,5,6,29,30,31,43,46,47,49,50,51,52]
% [2,3,7:28,32:42,44,45,48,53]
S2 = S1(:,[2,3,7:28,32:42,44,45,48,53]);
% S2 = 
% [ -(x2*x4)/p34, x3,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0, -(x2*x11)/v1,  x16,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0, -x2,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0, -(x2*x3)/p34, x23, -x2,           0]
% [            0,  0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,    0,                                                                              0,   0,    0,      0, -x6*((c2^p18*p17)/(c2^p18 + p16^p18) + 1),                                                                    0,                               0,   -x6, (k1*p28*p30*x7*x10^p6*x27^p10)/(k2*(p5^p6 + x10^p6)*(p9^p10 + x27^p10)),      0,            0,   0,   0, -p19*x6*x11]
% [            0,  0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,    0,                                                                              0,   0,    0,      0,                                         0,      -(p27*p29*x7*x10^p4*x27^p8)/((p3^p4 + x10^p4)*(p7^p8 + x27^p8)), (x8^p2*x9)/(k1*(p1^p2 + x8^p2)),     0,      -(p28*p30*x7*x10^p6*x27^p10)/((p5^p6 + x10^p6)*(p9^p10 + x27^p10)),      0,            0,   0,   0,           0]
% [            0,  0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0, -x8,   0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,            0,   0,   0,           0]
% [            0,  0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,    0, -(x21^p21*((p24*abs(c1)^p25)/(p26^p25 + abs(c1)^p25) - 1))/(p20^p21 + x21^p21), -x9,    0, k3*x19,                                         0,                                                                    0,     -(x8^p2*x9)/(p1^p2 + x8^p2), k2*x6,                                                                       0, k3*x24,            0,   0,   0,  p19*x6*x11]
% [            0,  0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0, -x10,   0,   0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,            0,   0,   0,           0]
% [            0,  0,                           0,  x15, 0,    0,                                            0, -p19*x11,  x14, -(x11*x24)/v1,  x12, -(x2*x11)/v1,  x16,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,            0,   0,   0,           0]
% [            0,  0,                           0,    0, 0,    0,                                            0,        0,    0,  (x11*x24)/v1, -x12,            0,    0,             0,    0,             0,    0,    0,    0, -p19*x12,        0,    0,   0,   0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,            0,   0,   0,           0]
% [            0,  0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,  (x14*x19)/v3, -x13,             0,    0,    0,    0,  p19*x12,        0,    0,   0,   0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,            0,   0,   0,           0]
% [            0,  0,                           0,    0, 0,    0,                                            0,  p19*x11, -x14,             0,    0,            0,    0, -(x14*x19)/v3,  x13, -(x14*x18)/v3,  x17, -x14,    0,        0,        0,    0,   0,   0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,            0,   0,   0,           0]
% [            0,  0, x21^p23/(p22^p23 + x21^p23), -x15, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,            0,   0,   0,           0]
% [            0,  0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,  (x2*x11)/v1, -x16,             0,    0,             0,    0,    0,    0,        0, -p19*x16,    0,   0,   0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,            0,   0,   0,           0]
% [            0,  0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0,  (x14*x18)/v3, -x17,    0,    0,        0,  p19*x16,    0,   0,   0, -x17,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,            0,   0,   0,           0]
% [            0,  0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0,             0,    0, -(x14*x18)/v3,  x17,    0, -x18,        0,        0,    0,   0,   0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,            0,   0,  x2,           0]
% [            0,  0,                           0,    0, 0,    0,                                            0,        0,    0,             0,    0,            0,    0, -(x14*x19)/v3,  x13,             0,    0,    0,    0,        0,        0,    0,   0,   0,    0,                                                                              0,   0,    0,   -x19,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,            0,   0,   0,           0]
% [            0,  0,                           0,    0, 1, -x20,  x20*((p14*p35^p15)/(p12^p15 + p35^p15) - 1),        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,    0,                                                                              0,   0,    0,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,            0,   0,   0,           0]
% [            0,  0,                           0,    0, 0,    0, -x20*((p14*p35^p15)/(p12^p15 + p35^p15) - 1),        0,    0,             0,    0,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,    0,                                                                              0,   0, -x21,      0,                                         0,                                                                    0,                               0,     0,                                                                       0,      0,            0,   0,   0,           0]
% [            0,  0,                           0,    0, 0,    0,                                            0,        0,    0, -(x11*x24)/v1,  x12,            0,    0,             0,    0,             0,    0,    0,    0,        0,        0,    0,   0,   0,    0,                                                                              0,   0,    0,      0,                                (k2*x6)/k3, (k1*p27*p29*x7*x10^p4*x27^p8)/(k3*(p3^p4 + x10^p4)*(p7^p8 + x27^p8)),                               0,     0,                                                                       0,   -x24,            0,   0,   0,           0]
%  
%% S3 remove all the term related to drugs, [1,2,36,37]
% f left corresponding to original:[7:28,32:42,44,45]

S3 = S2(:,[3:35,38,39]);
a = sym('a', [17 1]);
ker_fluxes3 = 0;
ker3 = null(S3);
size(ker3)

for i = 1:17
%     ker_fluxes = ker_fluxes + a(i) * transpose(ker)(1:56,i);
    ker_fluxes3 = ker_fluxes3 + ker3(1:35,i)*a(i);
end

%% ker_fluxex3
% ker_fluxes3 =
ker_f(1) = (a7*x14*(p22^p23 + x21^p23))/x21^p23 + (a9*x17*(p22^p23 + x21^p23))/x21^p23;
ker_f(2) = (a7*x14)/x15 + (a9*x17)/x15;
ker_f(3) = a1*x20 + a11*x21;
ker_f(4) = a1;
ker_f(5) = (a11*x21*(p12^p15 + p35^p15))/(x20*(p12^p15 - p14*p35^p15 + p35^p15));
ker_f(6) = (a8*x2)/(p19*x11) + (a2*x14)/(p19*x11) + (a16*x2)/(p19*x11) + (a7*x14)/(p19*x11) + (a9*x17)/(p19*x11) + (a15*x24)/(p19*x11) + (a17*k2*x6*(c2^p18 + p16^p18))/(k3*(c2^p18*p17 + c2^p18 + p16^p18)) - (a12*x8^p2*x9)/(k3*p19*x11*(p1^p2 + x8^p2)) + (a13*k2*x6*(c2^p18 + p16^p18))/(k3*p19*x11*(c2^p18*p17 + c2^p18 + p16^p18)) + (a14*c2^p18*k1*p17*p28*p30*x7*x10^p6*x27^p10)/(k3*p19*x11*(p5^p6 + x10^p6)*(p9^p10 + x27^p10)*(c2^p18*p17 + c2^p18 + p16^p18));
ker_f(7) = a2;
ker_f(8) = (a3*v1*x12)/(x11*x24) - (a15*v1)/x11 + (a12*v1*x8^p2*x9)/(k3*x11*x24*(p1^p2 + x8^p2)) - (a17*k2*p19*v1*x6*(c2^p18 + p16^p18))/(k3*x24*(c2^p18*p17 + c2^p18 + p16^p18)) - (a13*k2*v1*x6*(c2^p18 + p16^p18))/(k3*x11*x24*(c2^p18*p17 + c2^p18 + p16^p18)) - (a14*c2^p18*k1*p17*p28*p30*v1*x7*x10^p6*x27^p10)/(k3*x11*x24*(p5^p6 + x10^p6)*(p9^p10 + x27^p10)*(c2^p18*p17 + c2^p18 + p16^p18));
ker_f(9) = a3;
ker_f(10) = (a4*v1*x16)/(x2*x11) - (a16*v1)/x11 - (a8*v1)/x11;
ker_f(11) = a4;
ker_f(12) = (a5*v3*x13)/(x14*x19) + (a15*v3*x24)/(x14*x19) - (a12*v3*x8^p2*x9)/(k3*x14*x19*(p1^p2 + x8^p2)) + (a13*k2*v3*x6*(c2^p18 + p16^p18))/(k3*x14*x19*(c2^p18*p17 + c2^p18 + p16^p18)) + (a17*k2*p19*v3*x6*x11*(c2^p18 + p16^p18))/(k3*x14*x19*(c2^p18*p17 + c2^p18 + p16^p18)) + (a14*c2^p18*k1*p17*p28*p30*v3*x7*x10^p6*x27^p10)/(k3*x14*x19*(p5^p6 + x10^p6)*(p9^p10 + x27^p10)*(c2^p18*p17 + c2^p18 + p16^p18));
ker_f(13) = a5;
ker_f(14) = (a8*v3*x2)/(x14*x18) + (a16*v3*x2)/(x14*x18) + (a6*v3*x17)/(x14*x18) + (a9*v3*x17)/(x14*x18);
ker_f(15) = a6;
ker_f(16) = a7;
ker_f(17) = - (a8*x2)/x18 - (a9*x17)/x18;
ker_f(18) = (a12*x8^p2*x9)/(k3*p19*x12*(p1^p2 + x8^p2)) - (a15*x24)/(p19*x12) - (a13*k2*x6*(c2^p18 + p16^p18))/(k3*p19*x12*(c2^p18*p17 + c2^p18 + p16^p18)) - (a17*k2*x6*x11*(c2^p18 + p16^p18))/(k3*x12*(c2^p18*p17 + c2^p18 + p16^p18)) - (a14*c2^p18*k1*p17*p28*p30*x7*x10^p6*x27^p10)/(k3*p19*x12*(p5^p6 + x10^p6)*(p9^p10 + x27^p10)*(c2^p18*p17 + c2^p18 + p16^p18));
ker_f(19) = - (a8*x2)/(p19*x16) - (a16*x2)/(p19*x16);
ker_f(20) = 0;
ker_f(21) = 0;
ker_f(22) = a8;
ker_f(23) = a9;
ker_f(24) = (a10*x9*(p26^p25 + abs(c1)^p25)*(p20^p21 + x21^p21))/(x21^p21*(p26^p25 - p24*abs(c1)^p25 + abs(c1)^p25)) - (a13*c2^p18*k2*p17*x6*(p26^p25 + abs(c1)^p25)*(p20^p21 + x21^p21))/(x21^p21*(p26^p25 - p24*abs(c1)^p25 + abs(c1)^p25)*(c2^p18*p17 + c2^p18 + p16^p18)) - (a17*p19*x6*x11*(p26^p25 + abs(c1)^p25)*(p20^p21 + x21^p21)*(c2^p18*p17 - k2*p16^p18 + c2^p18 + p16^p18 - c2^p18*k2))/(x21^p21*(p26^p25 - p24*abs(c1)^p25 + abs(c1)^p25)*(c2^p18*p17 + c2^p18 + p16^p18)) + (a14*c2^p18*k1*p17*p28*p30*x7*x10^p6*x27^p10*(p26^p25 + abs(c1)^p25)*(p20^p21 + x21^p21))/(x21^p21*(p5^p6 + x10^p6)*(p9^p10 + x27^p10)*(p26^p25 - p24*abs(c1)^p25 + abs(c1)^p25)*(c2^p18*p17 + c2^p18 + p16^p18));
ker_f(25) = a10;
ker_f(26) = a11;
ker_f(27) = (a12*x8^p2*x9)/(k3*x19*(p1^p2 + x8^p2)) - (a15*x24)/x19 - (a13*k2*x6*(c2^p18 + p16^p18))/(k3*x19*(c2^p18*p17 + c2^p18 + p16^p18)) - (a17*k2*p19*x6*x11*(c2^p18 + p16^p18))/(k3*x19*(c2^p18*p17 + c2^p18 + p16^p18)) - (a14*c2^p18*k1*p17*p28*p30*x7*x10^p6*x27^p10)/(k3*x19*(p5^p6 + x10^p6)*(p9^p10 + x27^p10)*(c2^p18*p17 + c2^p18 + p16^p18));
ker_f(28) = (a14*k1*p28*p30*x7*x10^p6*x27^p10*(c2^p18 + p16^p18))/(k2*x6*(p5^p6 + x10^p6)*(p9^p10 + x27^p10)*(c2^p18*p17 + c2^p18 + p16^p18)) - (a17*p19*x11*(c2^p18 + p16^p18))/(c2^p18*p17 + c2^p18 + p16^p18) - (a13*(c2^p18 + p16^p18))/(c2^p18*p17 + c2^p18 + p16^p18);
ker_f(29) = (a12*x8^p2*x9*(p3^p4 + x10^p4)*(p7^p8 + x27^p8))/(k1*p27*p29*x7*x10^p4*x27^p8*(p1^p2 + x8^p2)) - (a14*p28*p30*x10^p6*x27^p10*(p3^p4 + x10^p4)*(p7^p8 + x27^p8))/(p27*p29*x10^p4*x27^p8*(p5^p6 + x10^p6)*(p9^p10 + x27^p10));
ker_f(30) = a12;
ker_f(31) = a13;
ker_f(32) = a14;
ker_f(33) = a15;
ker_f(34) = a16;
ker_f(35) = a17;
