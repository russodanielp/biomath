%% S = 
x = sym('x', [28 1]);
f = sym('f', [54 1]);
v = sym('v', [3 1]);
k = sym('k', [3 1]);
p = sym('p', [35 1]);
c = sym('c', [2 1]);
     S(1,52)     = x(27);
     S(1,50)     = -x(1); 
     S(1,7)      = -x(1); 
     S(1,51)     = -x(1); 
     S(1,6)      = x(6);
     S(2,1)      = 1;
     S(3,4)      = x(4); 
     S(3,29)     = -x(3); 
     S(3,49)     = -x(3); 
     S(3,46)     = x(24); 
     S(3,18)     = x(17); 
     S(3,17)     = -(x(12)*x(3))/v(1) ;
     S(3,3)      = -(x(5)*x(3))/p(34);
     S(3,45)     = -(x(4)*x(3))/p(34);
     S(4,46)     = x(24);
     S(4,4)      = -x(4); 
     S(4,2)      = -x(4);
     S(4,3)      = (x(5)*x(3))/p(34) ;
     S(4,45)     = -(x(4)*x(3))/p(34);
     S(5,31)     = x(23);
     S(5,5)      = -x(5);
     S(5,4)      = x(4);
     S(5,3)      = -(x(5)*x(3))/p(34);
     S(6,6)      = -x(6); 
     S(6,30)     = -x(6);
     S(6,48)     = 1;
     S(7,42)     = (x(11)^p(6)*x(28)^p(10)*x(8)*k(1)*p(30)*p(28))/(k(2)*(x(11)^p(6) + p(5)^p(6))*(x(28)^p(10) + p(9)^p(10)));
     S(7,38)     = -x(7)*((c(2)^p(18)*p(17))/(c(2)^p(18) + p(16)^p(18)) + 1);
     S(7,54)     = -x(12)*p(19)*x(7);
     S(7,41)     = -x(7);
     S(8,40)     = (x(9)^p(2)*x(10))/(k(1)*(x(9)^p(2) + p(1)^p(2)));
     S(8,39)     = -(x(11)^p(4)*x(28)^p(8)*x(8)*p(29)*p(27))/((x(11)^p(4) + p(3)^p(4))*(x(28)^p(8) + p(7)^p(8)));
     S(8,42)     = -(x(11)^p(6)*x(28)^p(10)*x(8)*p(30)*p(28))/((x(11)^p(6) + p(5)^p(6))*(x(28)^p(10) + p(9)^p(10)));
     S(9,28)     = -x(9);
     S(10,41)    = k(2)*x(7);
     S(10,54)    = x(12)*p(19)*x(7);
     S(10,35)    = -x(10);
     S(10,37)    = x(20)*k(3);
     S(10,43)    = x(25)*k(3);
     S(10,40)    = -(x(9)^p(2)*x(10))/(x(9)^p(2) + p(1)^p(2));
     S(10,34)    = -(x(22)^p(21)*((p(24)*abs(c(1))^p(25))/(p(26)^p(25) + abs(c(1))^p(25)) - 1))/(x(22)^p(21) + p(20)^p(21));
     S(11,27)    = -x(11);
     S(12,14)    = x(15);
     S(12,9)    = x(16);
     S(12,16)    = x(13);
     S(12,13)    = -x(12)*p(19);
     S(12,18)    = x(17);
     S(12,15)    = -(x(25)*x(12))/v(1);
     S(12,17)    = -(x(12)*x(3))/v(1);
     S(13,15)    = (x(25)*x(12))/v(1);
     S(13,25)    = -x(13)*p(19);
     S(13,16)    = -x(13);
     S(14,25)    = x(13)*p(19);
     S(14,20)    = -x(14);
     S(14,19)    = (x(20)*x(15))/v(3);
     S(15,20)    =x(14);
     S(15,23)    = -x(15);
     S(15,14)    = -x(15);
     S(15,13)    = x(12)*p(19) ;
     S(15,22)    = x(18);
     S(15,19)    = -(x(20)*x(15))/v(3) ;
     S(15,21)    = -(x(15)*x(19))/v(3);
     S(16,8)     = (x(22)^p(23))/(x(22)^p(23) + p(22)^p(23));
     S(16,9)    = -x(16);
     S(17,17)    = (x(12)*x(3))/v(1);
     S(17,18)    = -x(17);
     S(17,26)    = -p(19)*x(17);
     S(18,26)    = p(19)*x(17);
     S(18,33)    = -x(18);
     S(18,22)    = -x(18);
     S(18,21)    = (x(15)*x(19))/v(3);
     S(19,49)    = x(3);
     S(19,24)    = -x(19);
     S(19,22)    = x(18);
     S(19,21)    = -(x(15)*x(19))/v(3);
     S(20,20)    = x(14) ;
     S(20,37)    = -x(20);
     S(20,19)    = -(x(20)*x(15))/v(3);
     S(21,10)    = 1;
     S(21,11)    = -x(21);
     S(21,12)    = x(21)*((p(35)^p(15)*p(14))/(p(35)^p(15) + p(12)^p(15)) - 1);
     S(22,36)    = -x(22);
     S(22,12)    = -x(21)*((p(35)^p(15)*p(14))/(p(35)^p(15) + p(12)^p(15)) - 1);
     S(23,31)    = -x(23);
     S(23,32)    = -x(23);
     S(23,47)    = 1;
     S(24,45)    = (x(4)*x(3))/p(34);
     S(24,46)    = -x(24);
     S(24,44)    = -x(24);
     S(25,16)    = x(13);
     S(25,43)    = -x(25);
     S(25,15)    = -(x(25)*x(12))/v(1);
     S(25,38)    = (x(7)*k(2))/k(3);
     S(25,39)    = (x(11)^p(4)*x(28)^p(8)*x(8)*k(1)*p(29)*p(27))/(k(3)*(x(11)^p(4) + p(3)^p(4))*(x(28)^p(8) + p(7)^p(8)));
     S(26,50)    = x(1);
     S(26,53)    = -x(26);
     S(27,51)    = x(1);
     S(27,52)    = -x(27);
     
     S;
     
a = sym('a', [27 1]);
ker_fluxes = 0;
for i = 1:27
%     ker_fluxes = ker_fluxes + a(i) * transpose(ker)(1:56,i);
    ker_fluxes = ker_fluxes + ker(1:54,i)*a(i);
end
%% sample_from_kernel =

ker_fluxes =
0
(2*a21*x24)/x4 - (a10*x3)/x4 - (a24*x3)/x4 - (2*a20*x3)/p34 - (a9*p19*x17)/x4
(a1*p34*x4)/(x3*x5) - (a24*p34)/x5 - (a20*x4)/x5 - (a10*p34)/x5 + (a21*p34*x24)/(x3*x5) - (a9*p19*p34*x17)/(x3*x5)
a1
a22/x5 + (a10*x3)/x5 + (a24*x3)/x5 - (a12*x23)/x5 - (a21*x24)/x5 + (a9*p19*x17)/x5 + (a20*x3*x4)/(p34*x5)
a23/x6 - a11
a23/x1 - (a11*x6)/x1 - (a26*x26)/x1
(a8*x15*(p22^p23 + x22^p23))/x22^p23 + (a13*x18*(p22^p23 + x22^p23))/x22^p23
(a8*x15)/x16 + (a13*x18)/x16
a2*x21 + a15*x22
a2
(a15*x22*(p12^p15 + p35^p15))/(x21*(p12^p15 - p14*p35^p15 + p35^p15))
(a3*x15)/(p19*x12) - (a9*x17)/x12 + (a8*x15)/(p19*x12) + (a13*x18)/(p19*x12) + (a19*x25)/(p19*x12) + (a27*k2*x7*(c2^p18 + p16^p18))/(k3*(c2^p18*p17 + c2^p18 + p16^p18)) - (a16*x9^p2*x10)/(k3*p19*x12*(p1^p2 + x9^p2)) + (a17*k2*x7*(c2^p18 + p16^p18))/(k3*p19*x12*(c2^p18*p17 + c2^p18 + p16^p18)) + (a18*c2^p18*k1*p17*p28*p30*x8*x11^p6*x28^p10)/(k3*p19*x12*(p5^p6 + x11^p6)*(p9^p10 + x28^p10)*(c2^p18*p17 + c2^p18 + p16^p18))
a3
(a4*v1*x13)/(x12*x25) - (a19*v1)/x12 + (a16*v1*x9^p2*x10)/(k3*x12*x25*(p1^p2 + x9^p2)) - (a27*k2*p19*v1*x7*(c2^p18 + p16^p18))/(k3*x25*(c2^p18*p17 + c2^p18 + p16^p18)) - (a17*k2*v1*x7*(c2^p18 + p16^p18))/(k3*x12*x25*(c2^p18*p17 + c2^p18 + p16^p18)) - (a18*c2^p18*k1*p17*p28*p30*v1*x8*x11^p6*x28^p10)/(k3*x12*x25*(p5^p6 + x11^p6)*(p9^p10 + x28^p10)*(c2^p18*p17 + c2^p18 + p16^p18))
a4
(a5*v1*x17)/(x3*x12) + (a9*p19*v1*x17)/(x3*x12)
a5
(a6*v3*x14)/(x15*x20) + (a19*v3*x25)/(x15*x20) - (a16*v3*x9^p2*x10)/(k3*x15*x20*(p1^p2 + x9^p2)) + (a17*k2*v3*x7*(c2^p18 + p16^p18))/(k3*x15*x20*(c2^p18*p17 + c2^p18 + p16^p18)) + (a27*k2*p19*v3*x7*x12*(c2^p18 + p16^p18))/(k3*x15*x20*(c2^p18*p17 + c2^p18 + p16^p18)) + (a18*c2^p18*k1*p17*p28*p30*v3*x8*x11^p6*x28^p10)/(k3*x15*x20*(p5^p6 + x11^p6)*(p9^p10 + x28^p10)*(c2^p18*p17 + c2^p18 + p16^p18))
a6
(a7*v3*x18)/(x15*x19) + (a13*v3*x18)/(x15*x19) - (a9*p19*v3*x17)/(x15*x19)
a7
a8
(a24*x3)/x19 - (a13*x18)/x19 + (a9*p19*x17)/x19
(a16*x9^p2*x10)/(k3*p19*x13*(p1^p2 + x9^p2)) - (a19*x25)/(p19*x13) - (a17*k2*x7*(c2^p18 + p16^p18))/(k3*p19*x13*(c2^p18*p17 + c2^p18 + p16^p18)) - (a27*k2*x7*x12*(c2^p18 + p16^p18))/(k3*x13*(c2^p18*p17 + c2^p18 + p16^p18)) - (a18*c2^p18*k1*p17*p28*p30*x8*x11^p6*x28^p10)/(k3*p19*x13*(p5^p6 + x11^p6)*(p9^p10 + x28^p10)*(c2^p18*p17 + c2^p18 + p16^p18))
a9
0
0
a10
a11
a22/x23 - a12
a12
a13
(a14*x10*(p26^p25 + abs(c1)^p25)*(p20^p21 + x22^p21))/(x22^p21*(p26^p25 - p24*abs(c1)^p25 + abs(c1)^p25)) - (a17*c2^p18*k2*p17*x7*(p26^p25 + abs(c1)^p25)*(p20^p21 + x22^p21))/(x22^p21*(p26^p25 - p24*abs(c1)^p25 + abs(c1)^p25)*(c2^p18*p17 + c2^p18 + p16^p18)) - (a27*p19*x7*x12*(p26^p25 + abs(c1)^p25)*(p20^p21 + x22^p21)*(c2^p18*p17 - k2*p16^p18 + c2^p18 + p16^p18 - c2^p18*k2))/(x22^p21*(p26^p25 - p24*abs(c1)^p25 + abs(c1)^p25)*(c2^p18*p17 + c2^p18 + p16^p18)) + (a18*c2^p18*k1*p17*p28*p30*x8*x11^p6*x28^p10*(p26^p25 + abs(c1)^p25)*(p20^p21 + x22^p21))/(x22^p21*(p5^p6 + x11^p6)*(p9^p10 + x28^p10)*(p26^p25 - p24*abs(c1)^p25 + abs(c1)^p25)*(c2^p18*p17 + c2^p18 + p16^p18))
a14
a15
(a16*x9^p2*x10)/(k3*x20*(p1^p2 + x9^p2)) - (a19*x25)/x20 - (a17*k2*x7*(c2^p18 + p16^p18))/(k3*x20*(c2^p18*p17 + c2^p18 + p16^p18)) - (a27*k2*p19*x7*x12*(c2^p18 + p16^p18))/(k3*x20*(c2^p18*p17 + c2^p18 + p16^p18)) - (a18*c2^p18*k1*p17*p28*p30*x8*x11^p6*x28^p10)/(k3*x20*(p5^p6 + x11^p6)*(p9^p10 + x28^p10)*(c2^p18*p17 + c2^p18 + p16^p18))
(a18*k1*p28*p30*x8*x11^p6*x28^p10*(c2^p18 + p16^p18))/(k2*x7*(p5^p6 + x11^p6)*(p9^p10 + x28^p10)*(c2^p18*p17 + c2^p18 + p16^p18)) - (a27*p19*x12*(c2^p18 + p16^p18))/(c2^p18*p17 + c2^p18 + p16^p18) - (a17*(c2^p18 + p16^p18))/(c2^p18*p17 + c2^p18 + p16^p18)
(a16*x9^p2*x10*(p3^p4 + x11^p4)*(p7^p8 + x28^p8))/(k1*p27*p29*x8*x11^p4*x28^p8*(p1^p2 + x9^p2)) - (a18*p28*p30*x11^p6*x28^p10*(p3^p4 + x11^p4)*(p7^p8 + x28^p8))/(p27*p29*x11^p4*x28^p8*(p5^p6 + x11^p6)*(p9^p10 + x28^p10))
a16
a17
a18
a19
(a20*x3*x4)/(p34*x24) - a21
a20
a21
a22
a23
a24
(a26*x26)/x1
(a25*x27)/x1
a25
a26
a27
